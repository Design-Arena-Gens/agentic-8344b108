'use client';

import { useState } from 'react';
import { Shield, AlertTriangle, AlertCircle, Info, Search, Download, Play } from 'lucide-react';

const VulnerabilityScanner = () => {
  const [scanning, setScanning] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterSeverity, setFilterSeverity] = useState('all');

  const vulnerabilities = [
    {
      id: 'CVE-2024-1234',
      title: 'Windows Remote Code Execution Vulnerability',
      severity: 'Critical',
      cvss: 9.8,
      affected: ['Windows 10 v22H2', 'Windows 11 v23H2'],
      devices: 142,
      status: 'Patch Available',
      discovered: '2024-01-15',
      description: 'A remote code execution vulnerability exists in Windows SMB protocol.',
      remediation: 'Apply KB5034441 security update immediately.',
    },
    {
      id: 'CVE-2024-2345',
      title: 'macOS Privilege Escalation Vulnerability',
      severity: 'High',
      cvss: 7.8,
      affected: ['macOS Sonoma 14.2', 'macOS Ventura 13.6'],
      devices: 67,
      status: 'Patch Available',
      discovered: '2024-01-20',
      description: 'Local privilege escalation via kernel memory corruption.',
      remediation: 'Update to macOS 14.3 or 13.6.1.',
    },
    {
      id: 'CVE-2024-3456',
      title: 'Chrome Browser Memory Corruption',
      severity: 'High',
      cvss: 8.1,
      affected: ['Chrome < v120.0.6099'],
      devices: 234,
      status: 'Patch Available',
      discovered: '2024-01-18',
      description: 'Heap buffer overflow in V8 JavaScript engine.',
      remediation: 'Update Chrome to version 120.0.6099 or later.',
    },
    {
      id: 'CVE-2024-4567',
      title: 'Apache Log4j Denial of Service',
      severity: 'Medium',
      cvss: 5.3,
      affected: ['Apache Log4j 2.x'],
      devices: 45,
      status: 'Workaround Available',
      discovered: '2024-01-22',
      description: 'DoS vulnerability via crafted log messages.',
      remediation: 'Upgrade to Log4j 2.21.1 or apply configuration workaround.',
    },
    {
      id: 'CVE-2024-5678',
      title: 'OpenSSL Certificate Validation Bypass',
      severity: 'Medium',
      cvss: 6.5,
      affected: ['OpenSSL 3.0.x', 'OpenSSL 1.1.1'],
      devices: 89,
      status: 'Patch Available',
      discovered: '2024-01-25',
      description: 'Certificate verification can be bypassed under specific conditions.',
      remediation: 'Update to OpenSSL 3.0.13 or 1.1.1w.',
    },
    {
      id: 'CVE-2024-6789',
      title: 'Cisco Router Configuration Vulnerability',
      severity: 'Critical',
      cvss: 9.1,
      affected: ['Cisco IOS XE 17.x'],
      devices: 12,
      status: 'Patch Available',
      discovered: '2024-01-28',
      description: 'Unauthorized access to router configuration via web UI.',
      remediation: 'Apply Cisco Security Advisory patch.',
    },
    {
      id: 'CVE-2024-7890',
      title: 'Adobe Reader Information Disclosure',
      severity: 'Low',
      cvss: 3.3,
      affected: ['Adobe Acrobat Reader DC < 2024.001'],
      devices: 178,
      status: 'Patch Available',
      discovered: '2024-01-30',
      description: 'Out-of-bounds read could lead to memory disclosure.',
      remediation: 'Update Adobe Reader to version 2024.001 or later.',
    },
  ];

  const filteredVulnerabilities = vulnerabilities.filter(vuln => {
    const matchesSearch = vuln.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         vuln.id.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesSeverity = filterSeverity === 'all' || vuln.severity === filterSeverity;
    return matchesSearch && matchesSeverity;
  });

  const severityConfig = {
    'Critical': { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-300', icon: AlertTriangle },
    'High': { bg: 'bg-orange-100', text: 'text-orange-800', border: 'border-orange-300', icon: AlertCircle },
    'Medium': { bg: 'bg-yellow-100', text: 'text-yellow-800', border: 'border-yellow-300', icon: AlertCircle },
    'Low': { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-300', icon: Info },
  };

  const startScan = () => {
    setScanning(true);
    setTimeout(() => setScanning(false), 3000);
  };

  return (
    <div className="space-y-6">
      {/* Header Actions */}
      <div className="flex flex-wrap gap-4 items-center justify-between">
        <div className="flex-1 min-w-[300px]">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />
            <input
              type="text"
              placeholder="Search vulnerabilities by CVE or title..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
        </div>

        <div className="flex gap-3">
          <select
            value={filterSeverity}
            onChange={(e) => setFilterSeverity(e.target.value)}
            className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="all">All Severities</option>
            <option value="Critical">Critical</option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>

          <button
            onClick={startScan}
            disabled={scanning}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
              scanning
                ? 'bg-gray-400 cursor-not-allowed'
                : 'bg-green-600 hover:bg-green-700 text-white'
            }`}
          >
            <Play size={20} className={scanning ? 'animate-spin' : ''} />
            {scanning ? 'Scanning...' : 'Run Scan'}
          </button>

          <button className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
            <Download size={20} />
            Export Report
          </button>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
        <div className="bg-white p-4 rounded-lg border-l-4 border-red-500 shadow-sm">
          <p className="text-sm text-gray-600">Critical</p>
          <p className="text-2xl font-bold text-red-600">2</p>
        </div>
        <div className="bg-white p-4 rounded-lg border-l-4 border-orange-500 shadow-sm">
          <p className="text-sm text-gray-600">High</p>
          <p className="text-2xl font-bold text-orange-600">2</p>
        </div>
        <div className="bg-white p-4 rounded-lg border-l-4 border-yellow-500 shadow-sm">
          <p className="text-sm text-gray-600">Medium</p>
          <p className="text-2xl font-bold text-yellow-600">2</p>
        </div>
        <div className="bg-white p-4 rounded-lg border-l-4 border-blue-500 shadow-sm">
          <p className="text-sm text-gray-600">Low</p>
          <p className="text-2xl font-bold text-blue-600">1</p>
        </div>
        <div className="bg-white p-4 rounded-lg border-l-4 border-green-500 shadow-sm">
          <p className="text-sm text-gray-600">Patched</p>
          <p className="text-2xl font-bold text-green-600">142</p>
        </div>
      </div>

      {/* Vulnerabilities List */}
      <div className="space-y-4">
        {filteredVulnerabilities.map((vuln) => {
          const config = severityConfig[vuln.severity as keyof typeof severityConfig];
          const Icon = config.icon;

          return (
            <div key={vuln.id} className="bg-white rounded-lg shadow-md border border-gray-200 p-6">
              <div className="flex items-start gap-4 mb-4">
                <div className={`${config.bg} p-3 rounded-lg`}>
                  <Icon className={config.text} size={24} />
                </div>
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <span className="text-lg font-bold text-blue-600">{vuln.id}</span>
                    <span className={`px-3 py-1 rounded-full text-xs font-semibold border ${config.bg} ${config.text} ${config.border}`}>
                      {vuln.severity}
                    </span>
                    <span className="px-3 py-1 bg-gray-100 text-gray-700 rounded text-xs font-semibold">
                      CVSS: {vuln.cvss}
                    </span>
                    <span className="px-3 py-1 bg-green-100 text-green-700 rounded text-xs font-semibold">
                      {vuln.status}
                    </span>
                  </div>
                  <h3 className="text-lg font-semibold text-gray-800 mb-2">{vuln.title}</h3>
                  <p className="text-sm text-gray-600 mb-3">{vuln.description}</p>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                      <p className="text-gray-600 mb-1"><strong>Affected Systems:</strong></p>
                      <ul className="list-disc list-inside text-gray-700">
                        {vuln.affected.map((item, idx) => (
                          <li key={idx}>{item}</li>
                        ))}
                      </ul>
                    </div>
                    <div>
                      <p className="text-gray-600 mb-1"><strong>Remediation:</strong></p>
                      <p className="text-gray-700">{vuln.remediation}</p>
                    </div>
                  </div>

                  <div className="flex gap-4 mt-3 text-sm text-gray-600">
                    <span><strong>Affected Devices:</strong> {vuln.devices}</span>
                    <span><strong>Discovered:</strong> {vuln.discovered}</span>
                  </div>
                </div>
              </div>

              <div className="flex gap-2 pt-3 border-t border-gray-200">
                <button className="px-4 py-2 text-sm bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors">
                  View Affected Devices
                </button>
                <button className="px-4 py-2 text-sm bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-colors">
                  Apply Patch
                </button>
                <button className="px-4 py-2 text-sm bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg transition-colors">
                  Create Ticket
                </button>
                <button className="px-4 py-2 text-sm bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition-colors">
                  View CVE Details
                </button>
              </div>
            </div>
          );
        })}
      </div>

      {filteredVulnerabilities.length === 0 && (
        <div className="text-center py-12 bg-white rounded-lg border border-gray-200">
          <Shield className="mx-auto mb-4 text-green-600" size={64} />
          <p className="text-xl font-semibold text-gray-800 mb-2">No vulnerabilities found</p>
          <p className="text-gray-600">Your systems are secure or no matches for your filters.</p>
        </div>
      )}
    </div>
  );
};

export default VulnerabilityScanner;
