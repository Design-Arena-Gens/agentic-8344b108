'use client';

import { useState } from 'react';
import { Send, Bot, User, Zap, AlertCircle, CheckCircle, HelpCircle } from 'lucide-react';

const AIAssistant = () => {
  const [messages, setMessages] = useState([
    {
      role: 'assistant',
      content: 'Hello! I\'m your AI IT Support Assistant. I can help you with:\n\nâ€¢ Troubleshooting hardware and software issues\nâ€¢ Password resets and access requests\nâ€¢ Network connectivity problems\nâ€¢ Software installation guidance\nâ€¢ Security best practices\nâ€¢ Creating and tracking support tickets\nâ€¢ Vulnerability analysis\nâ€¢ Endpoint health diagnostics\n\nHow can I assist you today?',
      timestamp: new Date().toISOString(),
    }
  ]);
  const [inputMessage, setInputMessage] = useState('');
  const [isTyping, setIsTyping] = useState(false);

  const suggestedPrompts = [
    "How do I reset a user's password?",
    "My VPN won't connect, what should I do?",
    "Check the status of critical vulnerabilities",
    "What are the current SLA compliance metrics?",
    "Help me troubleshoot a printer issue",
    "Show me endpoints with high CPU usage",
  ];

  const commonIssues = [
    {
      title: 'VPN Connection Issues',
      icon: AlertCircle,
      color: 'text-red-600',
      bg: 'bg-red-50',
      solution: 'Check credentials, verify network connection, restart VPN client, clear cache.',
    },
    {
      title: 'Password Reset',
      icon: CheckCircle,
      color: 'text-green-600',
      bg: 'bg-green-50',
      solution: 'Use AD password reset tool, verify identity, update in all connected systems.',
    },
    {
      title: 'Software Installation',
      icon: Zap,
      color: 'text-blue-600',
      bg: 'bg-blue-50',
      solution: 'Check system requirements, verify license availability, use SCCM for deployment.',
    },
    {
      title: 'Printer Not Working',
      icon: HelpCircle,
      color: 'text-yellow-600',
      bg: 'bg-yellow-50',
      solution: 'Check power and connection, restart print spooler, reinstall drivers if needed.',
    },
  ];

  const handleSendMessage = (message: string) => {
    if (!message.trim()) return;

    // Add user message
    const userMessage = {
      role: 'user',
      content: message,
      timestamp: new Date().toISOString(),
    };
    setMessages(prev => [...prev, userMessage]);
    setInputMessage('');
    setIsTyping(true);

    // Simulate AI response
    setTimeout(() => {
      let response = '';

      if (message.toLowerCase().includes('password')) {
        response = `I can help you with password resets. Here's what you need to do:

1. **Verify User Identity**: Confirm the user's identity through security questions or manager approval
2. **Use AD Management Tool**: Navigate to Active Directory Users and Computers
3. **Reset Password**: Right-click on the user account â†’ Reset Password
4. **Update Systems**: Ensure the password is updated in:
   â€¢ Email system (Exchange/O365)
   â€¢ VPN access
   â€¢ Any SSO-enabled applications
5. **Notify User**: Send secure temporary password via authorized channel
6. **Force Change**: Require password change at next login

Would you like me to create a ServiceNow ticket for this request?`;
      } else if (message.toLowerCase().includes('vpn')) {
        response = `Let's troubleshoot the VPN connection issue:

**Level 1 Troubleshooting:**
1. Verify internet connectivity (can they browse websites?)
2. Check VPN client version (should be v12.5 or higher)
3. Verify credentials haven't expired
4. Try restarting the VPN client

**Level 2 Steps:**
1. Clear VPN cache and connection profiles
2. Check firewall settings (ports 443, 1194, 500 should be open)
3. Verify user is in 'VPN Users' AD group
4. Check for Windows updates that might interfere
5. Review VPN gateway logs for connection attempts

**Common Error Codes:**
â€¢ Error 800: Network issue between client and server
â€¢ Error 691: Invalid credentials
â€¢ Error 807: Connection interrupted

I've scanned the current ticket system and found 3 similar issues today. Would you like me to escalate this to Level 2 support?`;
      } else if (message.toLowerCase().includes('vulnerabilit')) {
        response = `**Current Vulnerability Status:**

ðŸ”´ **Critical: 2 vulnerabilities**
â€¢ CVE-2024-1234: Windows RCE (142 affected devices)
â€¢ CVE-2024-6789: Cisco Router Configuration (12 devices)

ðŸŸ  **High: 2 vulnerabilities**
â€¢ CVE-2024-2345: macOS Privilege Escalation (67 devices)
â€¢ CVE-2024-3456: Chrome Memory Corruption (234 devices)

**Recommended Actions:**
1. Apply KB5034441 for Windows vulnerability immediately
2. Deploy Chrome update v120.0.6099 via SCCM
3. Schedule macOS updates for affected Macs
4. Review Cisco security advisory patch

Patches are available for all critical vulnerabilities. Would you like me to generate a remediation report or create deployment tickets?`;
      } else if (message.toLowerCase().includes('sla')) {
        response = `**Current SLA Compliance Metrics:**

ðŸ“Š **Overall Performance:**
â€¢ SLA Compliance Rate: 94.2%
â€¢ Average Response Time: 12 minutes
â€¢ Average Resolution Time: 4.2 hours

**By Priority:**
â€¢ Critical (1h SLA): 96% met, 3 breaches this week
â€¢ High (4h SLA): 95% met
â€¢ Medium (8h SLA): 93% met
â€¢ Low (24h SLA): 98% met

**Recent Trends:**
â€¢ +5% improvement from last month
â€¢ Peak ticket times: 9-11 AM, 2-4 PM
â€¢ Most common breaches: Complex network issues requiring escalation

**At-Risk Tickets:**
â€¢ SNOW-4821: VPN issue (2h 15m remaining)
â€¢ SNOW-4822: Printer issue (3h 28m remaining)
â€¢ JIRA-2034: Software install (5h 42m remaining)

Would you like me to analyze any specific ticket or generate a detailed SLA report?`;
      } else if (message.toLowerCase().includes('printer')) {
        response = `Let's troubleshoot the printer issue:

**Quick Diagnostics:**
1. âœ“ Check if printer is powered on and connected
2. âœ“ Verify network connectivity (for network printers)
3. âœ“ Check paper jam or error lights
4. âœ“ Verify print queue isn't stuck

**Common Solutions:**

**For "Printer Offline":**
\`\`\`
1. Open Devices and Printers
2. Right-click printer â†’ "See what's printing"
3. Click Printer menu â†’ Uncheck "Use Printer Offline"
4. Restart print spooler service
\`\`\`

**For Driver Issues:**
1. Update/reinstall printer drivers
2. Remove printer completely, reboot, re-add
3. Use HP Print and Scan Doctor (for HP printers)

**For Network Printers:**
1. Ping printer IP address
2. Verify printer is on same subnet
3. Check firewall rules
4. Try accessing printer web interface

I've detected HP-FL3-01 on Floor 3 is showing warnings. Is this the printer you're working on?`;
      } else if (message.toLowerCase().includes('endpoint') || message.toLowerCase().includes('cpu')) {
        response = `**Endpoints with High Resource Usage:**

âš ï¸ **Critical:**
â€¢ LAPTOP-MAC-042: CPU 78%, Memory 92%, Disk 89%
  â†’ User: jane.smith@company.com
  â†’ Uptime: 12d 8h (recommend reboot)
  â†’ Pending macOS updates

â€¢ DESKTOP-WIN-156: CPU 89%, Memory 94%, Disk 91%
  â†’ User: chris.martinez@company.com
  â†’ Uptime: 28d 16h (definitely needs reboot)

**Recommended Actions:**
1. Schedule maintenance reboot for both devices
2. Check for resource-heavy applications
3. Clear temporary files and cache
4. Verify no malware/suspicious processes
5. Apply pending updates

Would you like me to:
â€¢ Run remote diagnostics
â€¢ Schedule maintenance windows
â€¢ Create tickets for user follow-up
â€¢ Generate detailed performance reports?`;
      } else {
        response = `I understand you need assistance. I have access to:

ðŸŽ« **Ticket Management**: Create, track, and resolve support tickets across ServiceNow, Jira, and Freshservice

ðŸ›¡ï¸ **Security & Compliance**: Monitor vulnerabilities, patch status, and security advisories

ðŸ’» **Endpoint Management**: Check device health, resource usage, and system status

ðŸ‘¥ **User Administration**: Help with password resets, account provisioning, and access management

ðŸ“Š **Analytics & Reporting**: Generate reports on SLA compliance, ticket trends, and system health

Could you provide more details about what you need help with? You can also select one of the suggested prompts above for quick assistance.`;
      }

      const assistantMessage = {
        role: 'assistant',
        content: response,
        timestamp: new Date().toISOString(),
      };

      setMessages(prev => [...prev, assistantMessage]);
      setIsTyping(false);
    }, 1500);
  };

  const handlePromptClick = (prompt: string) => {
    handleSendMessage(prompt);
  };

  return (
    <div className="h-full flex gap-6">
      {/* Main Chat Area */}
      <div className="flex-1 flex flex-col bg-white rounded-lg shadow-md border border-gray-200">
        {/* Chat Header */}
        <div className="p-4 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-blue-700 rounded-t-lg">
          <div className="flex items-center gap-3">
            <div className="bg-white p-2 rounded-lg">
              <Bot className="text-blue-600" size={24} />
            </div>
            <div>
              <h3 className="text-lg font-bold text-white">AI IT Support Assistant</h3>
              <p className="text-sm text-blue-100">Level 1 & Level 2 Technical Support</p>
            </div>
          </div>
        </div>

        {/* Messages Area */}
        <div className="flex-1 overflow-y-auto p-6 space-y-4">
          {messages.map((message, idx) => (
            <div key={idx} className={`flex gap-3 ${message.role === 'user' ? 'flex-row-reverse' : ''}`}>
              <div className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${
                message.role === 'user' ? 'bg-blue-600' : 'bg-gray-200'
              }`}>
                {message.role === 'user' ? (
                  <User className="text-white" size={18} />
                ) : (
                  <Bot className="text-gray-700" size={18} />
                )}
              </div>
              <div className={`flex-1 max-w-3xl ${message.role === 'user' ? 'text-right' : ''}`}>
                <div className={`inline-block p-4 rounded-lg ${
                  message.role === 'user'
                    ? 'bg-blue-600 text-white'
                    : 'bg-gray-100 text-gray-800'
                }`}>
                  <p className="whitespace-pre-wrap text-sm leading-relaxed">{message.content}</p>
                </div>
                <p className="text-xs text-gray-500 mt-1">
                  {new Date(message.timestamp).toLocaleTimeString()}
                </p>
              </div>
            </div>
          ))}

          {isTyping && (
            <div className="flex gap-3">
              <div className="flex-shrink-0 w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                <Bot className="text-gray-700" size={18} />
              </div>
              <div className="bg-gray-100 p-4 rounded-lg">
                <div className="flex gap-1">
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Suggested Prompts */}
        {messages.length === 1 && (
          <div className="px-6 pb-4">
            <p className="text-sm text-gray-600 mb-2">Suggested questions:</p>
            <div className="grid grid-cols-2 gap-2">
              {suggestedPrompts.map((prompt, idx) => (
                <button
                  key={idx}
                  onClick={() => handlePromptClick(prompt)}
                  className="text-left text-sm p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200"
                >
                  {prompt}
                </button>
              ))}
            </div>
          </div>
        )}

        {/* Input Area */}
        <div className="p-4 border-t border-gray-200">
          <div className="flex gap-2">
            <input
              type="text"
              value={inputMessage}
              onChange={(e) => setInputMessage(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleSendMessage(inputMessage)}
              placeholder="Type your question or describe the issue..."
              className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              disabled={isTyping}
            />
            <button
              onClick={() => handleSendMessage(inputMessage)}
              disabled={isTyping || !inputMessage.trim()}
              className="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2"
            >
              <Send size={20} />
              Send
            </button>
          </div>
        </div>
      </div>

      {/* Sidebar - Common Issues */}
      <div className="w-80 space-y-4">
        <div className="bg-white rounded-lg shadow-md border border-gray-200 p-4">
          <h3 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <Zap className="text-yellow-600" size={20} />
            Common Issues & Solutions
          </h3>
          <div className="space-y-3">
            {commonIssues.map((issue, idx) => {
              const Icon = issue.icon;
              return (
                <div key={idx} className={`${issue.bg} p-3 rounded-lg border border-gray-200`}>
                  <div className="flex items-center gap-2 mb-2">
                    <Icon className={issue.color} size={18} />
                    <h4 className="font-semibold text-sm text-gray-800">{issue.title}</h4>
                  </div>
                  <p className="text-xs text-gray-600">{issue.solution}</p>
                </div>
              );
            })}
          </div>
        </div>

        <div className="bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg shadow-md p-4 text-white">
          <h3 className="font-bold mb-2">AI-Powered Support</h3>
          <ul className="text-sm space-y-1 opacity-90">
            <li>âœ“ Instant troubleshooting guidance</li>
            <li>âœ“ Real-time system analysis</li>
            <li>âœ“ Automated ticket creation</li>
            <li>âœ“ SLA compliance tracking</li>
            <li>âœ“ Security vulnerability alerts</li>
          </ul>
        </div>
      </div>
    </div>
  );
};

export default AIAssistant;
